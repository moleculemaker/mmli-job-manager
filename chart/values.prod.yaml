ingress:
  hostname: jobmgr.mmli1.ncsa.illinois.edu
  tls: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-production
    kubernetes.io/tls-acme: "true"
    traefik.ingress.kubernetes.io/router.tls: "true"
    traefik.ingress.kubernetes.io/router.middlewares: oauth2-proxy-cors-header@kubernetescrd

persistence:
  existingClaim: "mmli-clean-job-weights"
  storageClassName: csi-cinder-sc-retain
  storageSize: "100Gi"

mariadb:
  global:
    storageClass: csi-cinder-sc-retain
  enabled: true
  auth:
    username: mmli
    existingSecret: "job-manager-mariadb"

hcaptcha:
  auth:
    existingSecret: "hcaptcha"

extraDeploy:
# Enable DecentCI backups
- apiVersion: v1
  kind: ConfigMap
  metadata:
    name: backups
    namespace: job-manager
    labels:  
      app.kubernetes.io/name: decentci-backups
      app.kubernetes.io/component: config
  data:
    backups: |
      - backup-name: decentci-backups-jobmgr-db
        schedule: "01 7 * * *"
        database:
          type: mysql
          host: job-manager-mariadb.job-manager.svc.cluster.local
          auth:
            username: mmli
            database: mmli
            passwordKey: mariadb-password
            existingSecret: job-manager-mariadb
    global: |
      enabled: true
      backup-nfs-path: /taiga/ncsa/radiant/bbfp/mmli1/backups/jobmgr
      backup-nfs-server: taiga-nfs.ncsa.illinois.edu

# Deploy SealedSecrets for hcaptcha secret
- apiVersion: bitnami.com/v1alpha1
  kind: SealedSecret
  metadata:
    creationTimestamp: null
    name: hcaptcha
    namespace: job-manager
  spec:
    encryptedData:
      secret: AgAX5Xzeavp/TcJ6dkShk526pEZFdoQf5R5TGsdIOoVjHr9Nm3CsYli8WV4q8OMgRzTiSZ4K2aQXM1t8UtcDBIWX0bklsD9D2goTrkqTKJQ9Qk20fbqZb/YYTSc4xDnjtVZ4HKmYER8pqBOtBgoh+QwXee+AcBSZFMrh1djAMW76yxddDRqIQdsGzI53YO/1QnmFWLHEe4ogHhOsADb1pqLYALYVn+zh3FA40jWTHi5e28me+fXJP/y10d9bYpp62VTzEYt778RMeCy0cUR8cxWpHCSJX+ZqPjWCXcJRjhvy+TnCqpY2+kB3BVSFYY55m9WFoUZ2ovj6fCBPPU+BpfcfZlAvT+tkh2xoMT3YB/awsDKAaYPQLWvZ1E0La1KLp9/IIFZVe8BLjdF9gtf7U650OvZ7LMfwvysMnfWL6Z/RPZwft+eEw+YtB691O8cIhmhFLxBQRlpqOWQfLXOm2wakib1DcWL+vnI+nbo2x0qbzSYalSy4LOqG7wWJ4q1O9//1ceuoGESiVPPx7iUGd0HiJPo324tbBevyYVji0wlJpUhwzdqvlyl1XWzDx2I+U8S0ypTpmDpWjONreGf/VNZSJNnih8Qwx7enan79PHxYfj1jfmiCZ6Efni9wctndPAa39AWftnTAA4fXQnUoxhTgo0lLw6NsMNYo2VxUqvG9IhCcOM4BwaRwen32KdsgJmOpku+J6kMpEjQ9E6xAyay8QIaIz6Bw/qwVW+1iFPUa5jiYgPmxPF2Pbx8=
    template:
      metadata:
        creationTimestamp: null
        name: hcaptcha
        namespace: job-manager
      type: Opaque

# Deploy SealedSecrets for database credentials
- apiVersion: bitnami.com/v1alpha1
  kind: SealedSecret
  metadata:
    creationTimestamp: null
    name: job-manager-mariadb
    namespace: job-manager
  spec:
    encryptedData:
      mariadb-password: AgCRJoLJdnW9apTbjbsi3dNkEpzw4IwK1o7RzleHLxq/izS8XIWB142qd3ICngMHVZrcZPr8xUwvKO3lYfGrOZx1hKPR4blHTeF/ReomsQryfVobVKzW0/ScS2qJhFD4To/n0VvaISWXBdSXl5ttw9FYR3tgpWarilwUCxRtohF+vCIyw8szrnf4b9Cjz1NXtqSsG27nAdHFVJDoVME0tOqhncyqK++KsOEmYJxxQ95LAFqk2jXTUgFLxfOnA8AcLV4mW1k4uxPdU07brVU5+GZumtOElYmVompzkBykUbEXKiR7hoARptg5ErwvIYVUtL8LejxT66Ae9xqB6q3HHCtgt3HmbUIjv838OceSsdEzjSdtIh5QNiFwy8vWaKW45Q4gyMcx3g53TyOyBeEgqTeaqP9SMZUlH7L7nZVojuOufsQjxmKr46uzNgW5nqMpOjekiOsqMmdO8RMBahLCDQklQsMOmWyV+8rDUQndHedZRWy1mb2w/dCcTzivcKmI9RejD5DI51XkXGSSCCy1QyKo2pLzai5vgY0pafy03ABx9D85r21KEFVEqo7pvTD3pdq6d4fZvDwMZx+k8i+00VLVEZyvIO4kF2AO6XMBeeDa+h+so4otzJ6zUJNes4UfTwqB43D0xxrum7l9U28oRQBF7jUsVPNjXU7D534kkjmsjD50khEPeNSIZJ+l+5WxLJ7JVmG52mDcDLvUTwOq4oa3r56K9/sMUpzw2VE5EC6R+zo6pKn55WNo
      mariadb-replication-password: AgBFAD5Om1KIH4c1i/XqCT4nMeFl8avpT9EzW0mIX6LnP73sbIs32S+05MD+1NIGzTQCHNntfxkYQIMJDQn6InYM/T5SAcSbJDnBK4XMXYp9hR4EPb0aYGyWw2AHJLh7Qz9fkB0WaWr6ARWWZXLMFsTzvTLfWo4aY7tbhAvTY13Yg+P/TGU8M2FoRA7TLG7mDrzSQh5875vk4J+ctGqNuUvtix1cT8zl/xxHu6W3mkfbZF4A1fBHtrBbFsiyVu7HjioCJh3yjqTLY5IuW3dqFri+Vtyk57v8otqvTNEVSk9av1+f5d8WkuDI3vSMnH3Ro0y1p0jFJmpA9mRX96M37hI07dKieXURcGv7iKmSSkHChdf+OrJrMmSnC0VSJsXyNEuLwBCr9zIgutMEx/8PEWPSqlRpJL02jtDactXRVeG14gH8pn/cb/rk2IcL7QDtMhPlehyWTR5ZsGD63AXXa7LlAeBNXSRRXaNg/cGi3C+Tydd9qzZsetOIlcVrRH4wdwhvfS81Az65MMyDm35/BNQMstViDxcW3SrbNo8Tra9OPzcUltSHwyqN/8XSXlhSMVs/d2BeA59qqrr0H48lRlDBwHZDokXfEVnPsVF9DOIZV1sLyCveQVUqBK9LKDGiIhXkphE1g4vqpK/uCoCW4eFq3YQJNqO38GNEcfGWzwoAT+80KzNVi9ixYqBhySnAYun40R6WUQc42j69YEIZI+EgrbXabUlQUVk9EJy+57zhdEnt9rXyl2eS
      mariadb-root-password: AgAd0e+th3yGm6fd0hzDrCnEw/uQc8ccUYZ5PIXUxG2EvhzB6BoZlQYgI/aSnb0nXekMZDnUxrZlW+Wvlm+IPe4xu+sguiFANymoVejHUMAq1RNyjkGtJCT8DNE6I5fGoGcL5ynhg9CB81+HeWJAF1WfO8SACSxevWcvghyfGSJd3/Ixf1E+FiEQO4fVJvsEmVES7LJn0rJi4s2yyV5NbVc3hbAbRlfWT4MhT5ThAeg8mx5EOaBibqK8e1jI/GGpAI3g3Qpher0t746GDwZ9NQcJqIJmJBu/iYhvbwzqeYWKiW/+RSfpMf1bV0xb+qFbLGRfLt6IqfI271XYebgcKe68pcwCXPL5GWxeUTfg8hvk/HYBcV7Tsib6rj/GhyMerh+C75Tkqo4YZgIJCgjTgkZ9JufA+m52LLS63Z1eKJ7k0IRWbZ4SHlhv2v8f4Yg/UWRFke563+Fbxi7YjuTPUaeGyZJWZgIzd3L9R38SXXtJFoHPsNUN39thRAX+dq1TAxb46U/Vsvn8Ipz7eYaPEFZluic9/zAOyNzWvEVdEi0ci4CFiduqvyPdI9iRG+66ji3qg1rukYcYq3sfdnLfaatL9TobVGy3c+ROM7eNGOLZxKYUxV9UrNneaIkGEINij81mvEQCIRM6dgtac68A/3s00lGbzFeTqJd1P310eDjT1pAVtL3THzEN9ptsNAVu1FfFUA0FRnZAteBoSUjQMekUvfIb2EduNaEG9SpGPz9mE8mqjZckkr7m
    template:
      metadata:
        creationTimestamp: null
        name: job-manager-mariadb
        namespace: job-manager
      type: Opaque





config:
  server:
    protocol: "https"
    ## API hostname. Must match the ingress.hostname value.
    hostName: "jobmgr.mmli1.ncsa.illinois.edu"
    namespace: "job-manager"
  oauth:
    userInfoUrl: "http://oauth2-proxy.oauth2-proxy.svc.cluster.local/oauth2/userinfo"
  uws:
    ## Server working directory to store generated job data
    workingVolume:
      claimName: "mmli-clean-job-weights"
      mountPath: "/uws"
      subPath: "uws"
    ## Central data volumes to be mounted in job containers
    volumes:
      - name: 'job-output'
        mountPath: '/app/data/inputs'
        subPath: 'input'
        claimName: 'mmli-clean-job-weights'
      - name: 'job-output'
        mountPath: '/app/results/inputs'
        subPath: 'output'
        claimName: 'mmli-clean-job-weights'
      - name: 'job-output'
        mountPath: '/root/.cache/torch/hub/checkpoints'
        subPath: 'weights'
        claimName: 'mmli-clean-job-weights'
    # - name: data
    #   claimName: mmli-data-pvc
    #   mountPath: "/data/mmli"
    #   subPath: ""
    #   readOnly: true
